$.fn.cloudTag=function(t){var e=$.extend({tumblrSite:location.hostname,showCount:!1,countDelimeterLeft:"(",countDelimeterRight:")",sortBy:"name",autoSize:!1,maxTags:null},t),a=this,n=0,o=0,r=function(t){n=t.response.blog.posts,u()},u=function(){var t=0,r=20,u=[];$.ajaxSetup({cache:!1});for(var s=function(t){for(var e=t.response.posts,s=0;s<e.length;s++)for(var i=e[s].tags,f=0;f<i.length;f++){var l=i[f];if(JSON.stringify(u).match('"'+l+'"'))for(var m in u)u[m].name==l&&u[m].count++;else u.push({name:l,count:1});o++}r>=n?$(a).html(c(u)):r+=20};n>t;)$.ajax({type:"GET",url:"http://api.tumblr.com/v2/blog/"+e.tumblrSite+"/posts",dataType:"jsonp",data:{api_key:e.apiKey,offset:t},success:function(t){s(t)}}),t+=20},c=function(t){"count"==e.sortBy?t.sort(function(t,e){return t.count>e.count?-1:t.count<e.count?1:t.name<e.name?-1:0}):"name"==e.sortBy&&t.sort(function(t,e){return t.name<e.name?-1:t.name>e.name?1:0});for(var a="",n=0,o=0;o<t.length;o++)n+=t[o].count;for(var o=0;o<(e.maxTags||t.length);o++){var r=t[o],u=r.name,c=r.count,s="";if(e.autoSize){var i=100/n*c;20>i?s="freq-1":40>i?s="freq-2":60>i?s="freq-3":80>i?s="freq-4":100>i&&(s="freq-5")}var f=e.showCount?" "+e.countDelimeterLeft+c+e.countDelimeterRight:"";a+='<li><a href="/tagged/'+u.replace(/\s+/g,"-")+'" class="'+s+'">'+u+f+"</a></li>"}return a};$.ajaxSetup({cache:!1}),$.ajax({type:"GET",url:"http://api.tumblr.com/v2/blog/"+e.tumblrSite+"/info",dataType:"jsonp",data:{api_key:e.apiKey},success:function(t){r(t)}})};